<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDS200 Scanner Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1e 100%);
            color: #00ff00;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #00ff00;
            padding-bottom: 20px;
        }
        
        h1 {
            font-size: 2.5em;
            text-shadow: 0 0 10px #00ff00;
            margin-bottom: 10px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 10px;
            animation: pulse 1s infinite;
        }
        
        .status-indicator.connected {
            background-color: #00ff00;
            box-shadow: 0 0 10px #00ff00;
        }
        
        .status-indicator.disconnected {
            background-color: #ff0000;
            box-shadow: 0 0 10px #ff0000;
            animation: none;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(0, 255, 0, 0.05);
            border: 2px solid #00ff00;
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            background: rgba(0, 255, 0, 0.1);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }
        
        .card-title {
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 15px;
            color: #00ff00;
            opacity: 0.7;
        }
        
        .card-value {
            font-size: 2em;
            font-weight: bold;
            word-break: break-all;
            text-shadow: 0 0 10px #00ff00;
        }
        
        .card-unit {
            font-size: 0.8em;
            opacity: 0.6;
            margin-left: 10px;
        }
        
        .signal-bars {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }
        
        .signal-bar {
            width: 8px;
            height: 30px;
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid #00ff00;
            border-radius: 2px;
            transition: all 0.3s ease;
        }
        
        .signal-bar.active {
            background: #00ff00;
            box-shadow: 0 0 10px #00ff00;
        }
        
        .main-display {
            background: rgba(0, 255, 0, 0.08);
            border: 3px solid #00ff00;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .frequency-display {
            font-size: 3.5em;
            font-weight: bold;
            text-shadow: 0 0 20px #00ff00;
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
        }
        
        .frequency-label {
            font-size: 1em;
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .info-item {
            background: rgba(0, 255, 0, 0.05);
            border: 1px solid #00ff00;
            border-radius: 5px;
            padding: 15px;
        }
        
        .info-label {
            font-size: 0.85em;
            opacity: 0.6;
            margin-bottom: 5px;
            text-transform: uppercase;
        }
        
        .info-value {
            font-size: 1.3em;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #00ff00;
            opacity: 0.6;
            font-size: 0.9em;
        }
        
        .timestamp {
            color: #00ff00;
            font-family: 'Courier New', monospace;
        }
        
        .error-message {
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid #ff0000;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            color: #ff6666;
        }
        
        .raw-data {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #00ff00;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.9em;
            font-family: 'Courier New', monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .raw-data pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 255, 0, 0.3);
            border-radius: 50%;
            border-top-color: #00ff00;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <span class="status-indicator connected" id="statusIndicator"></span>
                SDS200 Scanner Dashboard
            </h1>
            <p>Live Monitoring System</p>
        </header>
        
        <div id="errorContainer"></div>
        
        <div class="main-display">
            <div class="frequency-label">Current Frequency</div>
            <div class="frequency-display" id="frequency">--- MHz</div>
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label">Signal Strength</div>
                    <div class="info-value" id="signalStrength">--</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Mode</div>
                    <div class="info-value" id="mode">--</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Volume</div>
                    <div class="info-value" id="volume">--</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Squelch</div>
                    <div class="info-value" id="squelch">--</div>
                </div>
            </div>
        </div>
        
        <div class="dashboard">
            <div class="card">
                <div class="card-title">Model</div>
                <div class="card-value" id="model">Loading...</div>
            </div>
            
            <div class="card">
                <div class="card-title">Firmware</div>
                <div class="card-value" id="firmware">Loading...</div>
            </div>
            
            <div class="card">
                <div class="card-title">Connection Status</div>
                <div class="card-value" id="connectionStatus">Connecting...</div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-title">Raw Data</div>
            <div class="raw-data">
                <pre id="rawData">Waiting for data...</pre>
            </div>
        </div>
        
        <div class="footer">
            <p>Last Updated: <span class="timestamp" id="lastUpdate">--:--:--</span></p>
            <p>Refresh Rate: 1 second</p>
        </div>
    </div>
    
    <script>
        // Configuration
        const UPDATE_INTERVAL = 1000; // 1 second
        const DATA_FILE = '/tmp/sds200_data.json';
        
        function formatFrequency(freq) {
            if (!freq || freq === 'None') return '--- MHz';
            try {
                const num = parseFloat(freq);
                return isNaN(num) ? '--- MHz' : `${num.toFixed(6)} MHz`;
            } catch {
                return '--- MHz';
            }
        }
        
        function getSignalBars(strength) {
            if (!strength || strength === 'None') return 0;
            try {
                const val = parseInt(strength);
                return Math.max(0, Math.min(5, Math.floor((val + 100) / 20)));
            } catch {
                return 0;
            }
        }
        
        function displaySignalBars(count) {
            let html = '<div class="signal-bars">';
            for (let i = 0; i < 5; i++) {
                html += `<div class="signal-bar ${i < count ? 'active' : ''}"></div>`;
            }
            html += '</div>';
            return html;
        }
        
        function updateDashboard(data) {
            // Update status indicator
            const indicator = document.getElementById('statusIndicator');
            if (data.connected) {
                indicator.className = 'status-indicator connected';
            } else {
                indicator.className = 'status-indicator disconnected';
            }
            
            // Update connection status
            document.getElementById('connectionStatus').textContent = 
                data.connected ? 'Connected ✓' : 'Disconnected ✗';
            
            // Update model
            document.getElementById('model').textContent = 
                data.model || 'Unknown';
            
            // Update firmware
            document.getElementById('firmware').textContent = 
                data.firmware || 'Unknown';
            
            // Update main display
            document.getElementById('frequency').textContent = 
                formatFrequency(data.frequency);
            
            // Update signal strength
            const signalValue = document.getElementById('signalStrength');
            const bars = getSignalBars(data.signal_strength);
            signalValue.textContent = (data.signal_strength || '--');
            signalValue.innerHTML += displaySignalBars(bars);
            
            // Update mode
            document.getElementById('mode').textContent = 
                data.mode || '--';
            
            // Update volume
            document.getElementById('volume').textContent = 
                data.volume || '--';
            
            // Update squelch
            document.getElementById('squelch').textContent = 
                data.squelch || '--';
            
            // Update timestamp
            if (data.timestamp) {
                const date = new Date(data.timestamp);
                document.getElementById('lastUpdate').textContent = 
                    date.toLocaleTimeString();
            }
            
            // Update raw data
            document.getElementById('rawData').textContent = 
                JSON.stringify(data, null, 2);
            
            // Handle errors
            const errorContainer = document.getElementById('errorContainer');
            if (data.error) {
                errorContainer.innerHTML = `<div class="error-message">⚠️ Error: ${data.error}</div>`;
            } else {
                errorContainer.innerHTML = '';
            }
        }
        
        function fetchAndUpdate() {
            fetch(DATA_FILE)
                .then(response => response.json())
                .then(data => {
                    updateDashboard(data);
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    document.getElementById('errorContainer').innerHTML = 
                        `<div class="error-message">⚠️ Unable to fetch scanner data. Is the backend running?</div>`;
                });
        }
        
        // Initial update
        fetchAndUpdate();
        
        // Set up auto-refresh
        setInterval(fetchAndUpdate, UPDATE_INTERVAL);
    </script>
</body>
</html>